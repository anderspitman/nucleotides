#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', '..', 'lib'))

require 'yaml'
require 'evaluation'
require 'evaluation/aggregate'
require 'evaluation/reformat'

mapping, evaluations = ARGV.map{|i| YAML.load(File.read(i)) }

keys = ["benchmark_type", "data_id", "entry_id", "image", "task"]

output = Evaluation.remap(keys.length - 1 , evaluations) do |e|
  e = Evaluation::Aggregate.aggregate(e)
  if e[:status] == :ok
    e[:metrics] = Evaluation::Reformat.rename(e[:metrics], mapping)
  end
  e
end

puts YAML.dump(output)
